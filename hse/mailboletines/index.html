<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administración Dashboard HSE</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">

    <!-- datatables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css">
    <!-- datatables -->

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">

    <style>
        .botones {
            box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
        }
        
        .botones:hover {
            box-shadow: rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px;
        }
        
        .fondos {
            background-color: blue;
        }
    </style>

</head>

<body>

    <div class="container">
        <div class="jumbotron">
            <h2><img src="img/logo_m.png" height="80px" a lt=""> Email Boletines HSE!</h2>

        </div>
        <div class="contenido">
            <label for="">Asunto del email:</label>
            <input type="text" class="form-control" id="asunto" placeholder="Asunto">
            <label for="">Imágen del bolétin</label>
            <input type="file" class="form-control" id="foto">
            <label for="">Texto para link</label>
            <input type="text" class="form-control" id="texto" placeholder="Texto">
            <label for="">Link formulario</label>
            <input type="text" class="form-control" id="link" placeholder="Link">
            <button type="button" class="btn btn-success mt-2" onclick="enviar()">Enviar email masivo</button>
            <hr>
            <div id="preview" style="max-width: 800px;"></div>
        </div>
    </div>

    <footer>

    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!--  DataTables.net Plugin, full documentation here: https://datatables.net/  -->
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.print.min.js"></script>


    <script>
        var user = null
        var server = 'https://utitalco.com/server/'
        var arrayDatosHse = []
        var arrayDatosPermisos = []
        var recargarhse = null
        var recargarpermiso = null

        function cargando() {
            let timerInterval
            Swal.fire({
                title: 'Enviando Correos!',
                html: 'Un momento por favor...',
                timer: 60000,
                timerProgressBar: true,
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading()
                    timerInterval = setInterval(() => {

                    }, 1000)
                },
                willClose: () => {
                    clearInterval(timerInterval)
                }
            }).then((result) => {
                /* Read more about handling dismissals below */
                if (result.dismiss === Swal.DismissReason.timer) {

                }
            })

        }


        function enviar() {

            cargando()

            var asunto = $('#asunto').val()
            var texto = $('#texto').val()
            var link = $('#link').val()

            var formData = new FormData();

            var files = $('#foto')[0].files[0];
            formData.append('foto', files);
            formData.append('asunto', asunto);
            formData.append('texto', texto);
            formData.append('link', link);

            $.ajax({
                url: server + 'enviarEmailBoletines.php',
                type: 'post',
                data: formData,
                contentType: false,
                processData: false,
                success: function(response) {
                    console.log(response)

                    if (response.msn == "Ok") {

                        Swal.fire({
                            icon: 'info',
                            title: 'Enviado...'
                        }).then(() => {
                            location.reload()
                        })

                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Correos no enviados...!' + resp.msn,
                        })
                    }
                }
            });
        }

        document.getElementById("foto").onchange = function(e) {
            // Creamos el objeto de la clase FileReader
            let reader = new FileReader();

            // Leemos el archivo subido y se lo pasamos a nuestro fileReader
            reader.readAsDataURL(e.target.files[0]);

            // Le decimos que cuando este listo ejecute el código interno
            reader.onload = function() {
                let preview = document.getElementById('preview'),
                    image = document.createElement('img');

                image.src = reader.result;

                preview.innerHTML = '';
                preview.append(image);
            };
        }
    </script>

</body>

</html>
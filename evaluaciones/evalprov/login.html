<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - UT ITALCO</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" integrity="sha512-mSYUmp1HYZDFaVKK//63EcZq4iFWFjxSL+Z3T/aCt4IO9Cejm03q3NKKYN6pFQzY0SBOr8h+eCIAZHPXcpZaNw==" crossorigin="anonymous"
        referrerpolicy="no-referrer" />


    <style>
        .cab {
            background-color: rgb(9, 85, 160);
            color: white;
        }
        
        .oculto {
            display: none;
        }
        
        .visible {
            display: contents;
        }
        
        .milabel {
            background-color: rgb(9, 85, 160);
            color: white;
            width: 100%;
            padding: 15px;
        }
        
        .milabeltit {
            background-color: rgb(227, 252, 8);
            color: rgb(0, 0, 0);
            width: 100%;
            padding: 5px;
            padding-left: 15px;
        }
        
        .form-check {
            padding: 5px;
            padding-left: 40px;
        }
        
        .opc {
            padding: 8px;
            padding-left: 40px;
        }
        
        th {
            text-align: center;
        }
        
        td {
            text-align: center;
        }
        
        .conv {
            font-size: 10px;
            font-family: 'Arial Narrow', Arial, sans-serif;
        }
    </style>
    <style>
        #preview {
            border: 1px solid #ddd;
            padding: 5px;
            border-radius: 2px;
            background: #fff;
            max-width: 600px;
        }
        
        #preview img {
            width: 100%;
            display: block;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="jumbotron cab">
            <center>
                <img src="img/logo_p.png" width="300px" alt="">
            </center>
            <h5 class="text-center pt-3">SATISFACCIÓN DEL SERVICIO O PRODUCTO</h5>
            <center>Contrato: 3023605 Mantenimiento con parada de planta y en operación de las unidades de la refinería de Barrancabermeja.</center>


        </div>

        <div id="cuerpo">

            <label for="" class="milabel">
                Ingreso al portal
            </label>

            <div class="form-group">
                <label for="">Correo</label>
                <input type="email" id="email" class="form-control" placeholder="Email">
            </div>

            <div class="form-group">
                <label for="" class="">
                    Contraseña
                </label>
                <input type="password" id="clave" class="form-control" placeholder="Contraseña">
            </div>

            <div class="form-group">
                <label for="" class="">
                    Proveedor
                </label>
                <select id="proveedor" class="form-control">
                    
                </select>
            </div>

            <div class="form-group">
                <label for="" class="">
                    ODS
                </label>
                <select id="ods" class="form-control">
                    <option value="033">033 - CALDERA SB-2405</option>
       
                </select>
            </div>

            <div class="form-group">
                <label for="" class="">
                    Aspecto a evaluar
                </label>
                <select id="aspecto" class="form-control">
                    <option value="Ejecución de actividades">Ejecución de actividades</option>
                    <option value="Calidad">Calidad</option>
                    <option value="HSE">HSE</option>
                    <option value="Administrativos y Laborales">Administrativos y Laborales</option>
                </select>
            </div>


            <div class="form-group text-center mt-5">
                <button type="button" class="btn btn-info" style="background-color: rgb(9, 85, 160);" onclick="verificar()">Ingresar</button>
            </div>



        </div>


        <hr>
        <center>
            Realizado por Departamento de Innovacion y Desarrollo Tecnólogico UT Italco Barrancabermeja
        </center>
        <hr>



    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>

    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>




    <script>
        var server = 'http://italco.tk/server/';

        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        // var pag = getParameterByName('pag');

        // pag = pag + '.html';

        var arrayProv = []

        cargarProv();

        function cargarProv() {
            var server = 'https://utitalco.com/evaluaciones/evalprov/'

            $.post(server + 'cargarProv.php', {},
                function(resp) {
                    html = ''
                    arrayProv = resp
                    for (var i = 0; i < arrayProv.length; i++) {
                        html += `
                    <option value="${arrayProv[i].id}-${arrayProv[i].empresa}">${arrayProv[i].empresa}</option>
                    `
                    }
                    $('#proveedor').html(html)
                })
        }

        function verificar() {

            var server = 'https://utitalco.com/evaluaciones/evalprov/'

            var user = $('#email').val()
            var clave = $('#clave').val()
            var aspecto = $('#aspecto').val()
            var ods = $('#ods').val()

            var idprov = $('#proveedor').val()

            myArr = idprov.split("-");
            idprov = parseInt(myArr[0]);

            var prov = myArr[1];

            $.post(server + 'verificaruser.php', {
                    user: user,
                    clave: clave
                },
                function(resp) {
                    if (resp.msn == 'Ok') {
                        sessionStorage.setItem('user', user)
                        sessionStorage.setItem('nombres', resp.nombres)
                        sessionStorage.setItem('cargo', aspecto)
                        sessionStorage.setItem('idprov', idprov)
                        sessionStorage.setItem('prov', prov)
                        sessionStorage.setItem('ods', ods)

                        Swal.fire({
                            position: 'top-end',
                            icon: 'success',
                            title: 'Ingreso correcto',
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => {
                            location = 'index.html'
                        })
                    } else {
                        Swal.fire({
                            position: 'top-end',
                            icon: 'info',
                            title: 'Error en email o contraseña',
                            showConfirmButton: false,
                            timer: 2500
                        })
                    }
                })

        }
    </script>

</body>

</html>
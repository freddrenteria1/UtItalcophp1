<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIG UT ITALCO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        main{
            font-family: 'Arial Narrow', Arial, sans-serif;
        }
        .milink{
            cursor: pointer;
        }
    </style>

</head>
<body>
    <main>
        
            <div id="cab">
                <img src="img/header_1.jpg" style="width: 100%;" alt="">
            </div>
        <div class="container mt-2">
            <div class="row">
                <div class="col-sm-2 milink" onclick="login()">
                    <img src="img/inicio.png" height="60px" alt=""> <span style="font-size: large;"> Inicio</span>
                </div>
                <div class="col-sm-2 milink" onclick="buscar()">
                    <img src="img/buscar.png"  height="60px" alt=""> <span style="font-size: large;"> BÃºsqueda</span>
                </div>
                <div class="col-sm-8 mt-2">
                    <select id="categorias" class="form-control" placeholder="Seleccione Categoria..." onchange="cargarSub()">
                        <option value="">Seleccione tipo documental...</option>
                    </select>
                </div>
            </div>

             
            <div class="container p-3" style="background-color: rgb(193, 212, 255);">
                Tipos documental: <span id="numcat">0</span>
            </div>

            
            <div class="mt-3 p-2">
                <table width="100%" id="tblCat">

                    

                </table>
            </div>
              

        </div>
         
    </main>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <script>
        var url = 'https://utitalco.com/sig/server/';
        var user = sessionStorage.getItem('usersig');
        var cat = sessionStorage.getItem('categorias');
        var arrayCat = []
        var html = ''
        var texto = ''
        var categoria = ''

        if(user == null){
            location = 'login.html'
        }

        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        var idcat = getParameterByName('idcat');

        cargar_subcat();

        function cargar_subcat(){
            $.post(url+'cargarSubCat.php',{id:idcat},
            function(resp){
                arrayCat = resp
                texto = ''
                html = '<option value="">Seleccione Tipo Documental...</option>'
                for(var i=0; i<arrayCat.length; i++){
                    html += `
                        <option value="${arrayCat[i].idsubcat}">${arrayCat[i].subcategoria}</option>
                    `
                    texto +=  `
                    <tr valign="top" border="0px">
                        <td width="5%" style="padding:5px;">
                            <a href='archivos.html?idsubcat=${arrayCat[i].idsubcat}'>
                                <img src="img/folder.png" align="top" width="48" height="48" border="0" alt="" /> 
                            </a>
                        </td>
                        <td width="70%" style="padding:5px;"><b><a href='archivos.html?idsubcat=${arrayCat[i].idsubcat}'>${arrayCat[i].subcategoria}</a></b></td>
                        <td width="15%" style="padding:5px; text-align:right"></td>
                        <td width="10%" style="padding:5px; text-align:right">Archivos: ${arrayCat[i].cantarch}</td>
                    </tr>
                    <tr valign="top" border="0px" style="border-bottom: 1px solid #cccccc;">
                      <td colspan="3" width="100%" style="padding:5px;"></td>
                    </tr>
                    `
                }
                $('#categorias').html(html)
                $('#tblCat').html(texto)
                $('#numcat').html(arrayCat.length)
            })
        }

        function cargarSub(){
            categoria = $('#categorias').val()
            location = 'archivos.html?idsubcat='+categoria
        }

        function login(){
            location = 'index.html';
        }

        function buscar(){
            location = 'busqueda.html';
        }



    </script>
</body>
</html>
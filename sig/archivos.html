<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIG UT ITALCO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        main{
            font-family: 'Arial Narrow', Arial, sans-serif;
        }
        .milink{
            cursor: pointer;
        }
    </style>

</head>
<body>
    <main>
        
            <div id="cab">
                <img src="img/header_1.jpg" style="width: 100%;" alt="">
            </div>
        <div class="container mt-2">
            <div class="row">
                <div class="col-sm-2 milink" onclick="login()">
                    <img src="img/inicio.png" height="60px" alt=""> <span style="font-size: large;"> Inicio</span>
                </div>
                <div class="col-sm-2 milink" onclick="buscar()">
                    <img src="img/buscar.png"  height="60px" alt=""> <span style="font-size: large;"> Búsqueda</span>
                </div>
                <div class="col-sm-8 mt-2">
                   
                </div>
            </div>

             
            <div class="container p-3" style="background-color: rgb(193, 212, 255);">
                Número de Archivos: <span id="numcat">0</span>
            </div>

            
            <div class="mt-3 p-2">
                <table width="100%">
                    <thead>
                        <th></th>
                        <th style="text-align:center;">Código</th>
                        <th style="text-align:center;">Nombre</th>
                        <th style="text-align:center;">Versión</th>
                        <th style="text-align:center;">Descargas</th>
                        <th></th>
                    </thead>
                    <tbody id="tblCat">

                    </tbody>
                    

                </table>
            </div>
              

        </div>
         
    </main>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <script>
        var url = 'https://utitalco.com/sig/server/';
        var user = sessionStorage.getItem('usersig');
        var cat = sessionStorage.getItem('categorias');
        var arrayCat = []
        var html = ''
        var texto = ''
        var categoria = ''

        if(user == null){
            location = 'login.html'
        }

        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        var idsubcat = getParameterByName('idsubcat');

        cargar_subcat();

        function cargar_subcat(){
            $.post(url+'cargarArchivos.php',{id:idsubcat},
            function(resp){
                arrayCat = resp
                texto = ''
                
                for(var i=0; i<arrayCat.length; i++){
                    
                    texto +=  `
                    <tr valign="middle" border="0px">
                        <td width="5%" style="padding:5px;">
                            <a href='javascript:void(0)'>
                                <img src="img/doc.png" align="top" width="48" height="48" border="0" alt="" /> 
                            </a>
                        </td>
                        <td width="10%" style="padding:5px; text-align:center;"><b><a href='javascript:void(0)'>${arrayCat[i].prefijo}</a></b></td>
                        <td width="50%" style="padding:5px;"><b><a href='javascript:void(0)'>${arrayCat[i].nombre}</a></b></td>
                        <td width="15%" style="padding:5px; text-align:center">Versión: ${arrayCat[i].version}</td>
                        <td width="10%" style="padding:5px; text-align:center"> ${arrayCat[i].descargas}</td>
                        <td width="10%" style="padding:5px; text-align:center">
                            <a href='javascript:void(0)' onclick="descargar('${arrayCat[i].archivo}','${arrayCat[i].id}','${arrayCat[i].nombre}')">
                                <img src="img/descargar.png" align="top" height="38" border="0" alt="" /> 
                            </a>
                        </td>
                    </tr>
                    <tr valign="top" border="0px" style="border-bottom: 1px solid #cccccc;">
                      <td colspan="3" width="100%" style="padding:5px;"></td>
                    </tr>
                    `
                }
                 
                $('#tblCat').html(texto)
                $('#numcat').html(arrayCat.length)
            })
        }

        function cargarSub(){
            categoria = $('#categorias').val()
            location = 'archivos.html?idsub='+categoria
        }

        function login(){
            location = 'index.html';
        }

        function buscar(){
            location = 'busqueda.html';
        }

        function descargar(arch, id, nombre){
        
            $.post(url+'sumarDesc.php',{id:id, nombre:nombre, user:user},
            function(resp){
                var urls = 'https://utitalco.com/sig/archivos/'+arch
                window.open(urls, '_blank');
                cargar_subcat()
            })

        }



    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIG UT ITALCO - ADMINISTRADOR</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        main{
            font-family: 'Arial Narrow', Arial, sans-serif;
        }
        .milink{
            cursor: pointer;
        }
    </style>

</head>
<body>
    <main>
        
            <div id="cab">
                <img src="img/header_1.jpg" style="width: 100%;" alt="">
            </div>
        <div class="container mt-3">
            

            <div class="row">
                <div class="col-sm-2 milink" onclick="inicio()">
                    <img src="img/inicio.png" height="60px" alt=""> <span style="font-size: large;"> Inicio</span>
                </div>
                
                <div class="col-sm-8 mt-2">
                    <h2>PLATAFORMA ADMINISTRATIVA - PROCESOS </h2>
                </div>

                <div class="col-sm-2  mt-2">
                    <button type="button" class="btn btn-success" onclick="agregar()">Agregar</button>
                </div>
            </div>

           <hr>

            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <th></th>
                        <th></th>
                    </thead>
                    <tbody id="tbldatos">

                    </tbody>
                </table>
            </div>

        </div>
         
    </main>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        var url = 'https://utitalco.com/sig/server/';
        var user = sessionStorage.getItem('usersigadmin');
        var html = ''
        var texto = ''
        var arrayCat = []

        cargarCategorias()

        if(user == null){
            location = 'login.html'
        }

        function inicio(){
            location = 'index.html';
        }

        function buscar(){
            location = 'busqueda.html';
        }

        function cargarCategorias(){
            $.post(url+'cargarCats.php',{},
            function(resp){
                arrayCat = resp
                var html = ''

                for(var i=0; i<arrayCat.length; i++){
                    html += `
                        <tr>
                            <td>${arrayCat[i].categoria}</td>
                            <td>
                                <div class="btn-group" role="group" aria-label="Basic example">
                                    <button type="button" class="btn btn-danger btn-small" onclick="borrar('${i}')">B</button>
                                    <button type="button" class="btn btn-warning btn-small" onclick="editar('${i}')">E</button>
                                </div>    
                            </td>
                        </tr>
                    `
                }
                $('#tbldatos').html(html)


            })
        }

        function borrar(i) {
            var idcat = arrayCat[i].idcat
            Swal.fire({
                title: 'Eliminar proceso',
                html: `
                    Â¿Dese borrar el proceso ${arrayCat[i].categoria}?
                `,
                width: 600,
                showCancelButton: true,
                confirmButtonText: 'Eliminar'
            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {

                    $.post(url + 'borrarCat.php', {
                            id: idcat
                        },
                        function(resp) {
                            if (resp.msn == 'Ok') {
                                Swal.fire({
                                    position: 'top-end',
                                    icon: 'success',
                                    title: 'Eliminar...',
                                    text: 'Proceso eliminado...!',
                                    showConfirmButton: false,
                                    timer: 1500
                                }).then(() => {
                                    location.reload()
                                })
                            } else {
                                Swal.fire({
                                    position: 'top-end',
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: resp.msn,
                                    showConfirmButton: false,
                                    timer: 1500
                                })
                            }
                        })


                }
            })
        }


        function editar(i){
            var cat = arrayCat[i].categoria
            var idcat = arrayCat[i].idcat

            Swal.fire({
                title: 'Editar Proceso',
                html: `
                    <input type="text" class="form-control" id="catedit" value="${cat}">
                `,
                showCancelButton: true,
                confirmButtonText: 'Actualizar'
            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                    var categ = $('#catedit').val()
                    $.post(url+'editCat.php',{id:idcat,cat:categ},
                    function(resp){
                        Swal.fire({
                            position: 'top-end',
                            icon: 'success',
                            title: 'Guardado!!!',
                            showConfirmButton: false,
                            timer: 1500
                        }).then(()=>{
                            location.reload()
                        })
                    })
                }  
            })

        }

        function agregar(){
            

            Swal.fire({
                title: 'Agregar Proceso',
                html: `
                    <input type="text" class="form-control" id="catedit" placeholder="Proceso...">
                `,
                showCancelButton: true,
                confirmButtonText: 'Guardar'
            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                    var categ = $('#catedit').val()
                    $.post(url+'agregarCat.php',{cat:categ},
                    function(resp){
                        Swal.fire({
                            position: 'top-end',
                            icon: 'success',
                            title: 'Guardado!!!',
                            showConfirmButton: false,
                            timer: 1500
                        }).then(()=>{
                            location.reload()
                        })
                    })
                }  
            })

        }


    </script>
</body>
</html>
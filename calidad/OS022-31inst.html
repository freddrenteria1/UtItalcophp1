<!DOCTYPE html>

<html>

<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title></title>
	<meta name="generator" content="LibreOffice 7.3.2.2 (Linux)" />
	<meta name="author" content="ALQUILER BESTPRINT" />
	<meta name="created" content="2020-09-01T20:49:06" />
	<meta name="changed" content="2022-09-14T12:29:11" />
	<meta name="AppVersion" content="15.0000" />

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

	<style type="text/css">
		body,
		div,
		table,
		thead,
		tbody,
		tfoot,
		tr,
		th,
		td,
		p {
			font-family: "Arial";
			font-size: x-small
		}

		a.comment-indicator:hover+comment {
			background: #ffd;
			position: absolute;
			display: block;
			border: 1px solid black;
			padding: 0.5em;
		}

		a.comment-indicator {
			background: red;
			display: inline-block;
			border: 1px solid black;
			width: 0.5em;
			height: 0.5em;
		}

		comment {
			display: none;
		}
	</style>

	<style>
		@media print {

			.oculto-impresion,
			.oculto-impresion * {
				display: none !important;
			}
		}

		.salto {
			PAGE-BREAK-AFTER: always;
		}

		.mispan {
			font-size: 16px;
		}

		textarea {
			font-size: 18px;
		}

		input[type=text] {
			width: 100%;
			padding: 12px;
			margin: 8px 0;
			border: 0;
			box-sizing: border-box;
			font-size: 18px;

		}

		.lineabaja {
			border-bottom-style: solid;
			border-bottom-width: 1px;
		}

		input[type=date] {
			width: 100%;
			padding: 12px;
			margin: 8px 0;
			border: 0;
			box-sizing: border-box;
			font-size: 18px;
		}

		input[type=time] {
			width: 100%;
			padding: 12px;
			margin: 8px 0;
			border: 0;
			box-sizing: border-box;
			font-size: 18px;
		}

		input[type=radio] {
			height: 20px;
			width: 20px;
		}

		select {
			background: transparent;
			border: none;
			font-size: 18px;
			height: 30px;
			padding: 5px;
			width: 250px;
		}

		.oculto {
			display: none;
		}

		.visible {
			display: inline;
		}

		.cuerpo {
			margin: 0 auto;
		}
	</style>

</head>

<body>
	<table id="tblcuerpo" cellspacing="0" border="0" style="margin: 0 auto; margin-top: 10px; width: 90%;">
		<colgroup width="75"></colgroup>
		<colgroup width="194"></colgroup>
		<colgroup width="50"></colgroup>
		<colgroup width="201"></colgroup>
		<colgroup width="198"></colgroup>
		<colgroup width="151"></colgroup>
		<colgroup width="284"></colgroup>
		<colgroup width="140"></colgroup>
		<colgroup width="185"></colgroup>
		<colgroup width="145"></colgroup>
		<colgroup width="350"></colgroup>
		<tr>
			<td style="border-top: 2px solid #000000; border-bottom: 1px solid #000000; border-left: 2px solid #000000; border-right: 1px solid #000000"
				colspan=3 rowspan=3 height="99" align="center" valign=middle>
				<img src="img/logo_m.png" width="180px" alt="">
			</td>
			<td style="border-top: 2px solid #000000; border-bottom: 1px solid #000000" colspan=5 rowspan=3
				align="center" valign=middle><b>
					<font face="Arial Narrow" size=5>REGISTRO DE CONTROL DE ACTIVIDADES DE MISCELANEOS Y/O LAZOS DE
						CORROSION</font>
				</b></td>
			<td style="border-top: 2px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 2px solid #000000"
				align="center" valign=middle colspan="3"><b>
					<font face="Arial Narrow" size=4>FRM-BCA-19.370.3.OS022-31</font>
				</b></td>
		</tr>
		<tr>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 2px solid #000000"
				align="center" valign=middle colspan="3"><b>
					<font face="Arial Narrow" size=4>Fecha: 24/03/2022</font>
				</b></td>
		</tr>
		<tr>
			<td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 2px solid #000000"
				align="center" valign=middle colspan="3"><b>
					<font face="Arial Narrow" size=4>Versión: 0</font>
				</b></td>
		</tr>
		<tr>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 2px solid #000000; border-right: 2px solid #000000"
				colspan=11 height="50" align="center" valign=middle bgcolor="#D9D9D9"><b>
					<font face="Arial Narrow" size=4>INFORMACIÓN GENERAL</font>
				</b></td>
		</tr>
		<tr>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 2px solid #000000; border-right: 1px solid #000000"
				colspan=2 height="50" align="center" valign=middle bgcolor="#D9D9D9"><b>
					<font face="Arial Narrow" size=4>UNIDAD:</font>
				</b></td>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
				colspan=2 align="center" valign=middle>
				<font face="Arial Narrow" size=4><span id="unidad"></span></font>
			</td>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
				colspan=2 align="center" valign=middle bgcolor="#D9D9D9"><b>
					<font face="Arial Narrow" size=4>LAZO DE CORROSIÓN:</font>
				</b></td>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
				align="center" valign=middle sdnum="1033;0;0">
				<font face="Arial Narrow" size=4><span id="lazo"></span></font>
			</td>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
				colspan=2 rowspan=2 align="center" valign=middle bgcolor="#D9D9D9"><b>
					<font face="Arial Narrow" size=4>ISOMÉTRICO:</font>
				</b></td>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 2px solid #000000"
				colspan=2 rowspan=2 align="center" valign=middle bgcolor="#FFFFFF"><b>
					<font face="Arial Narrow" size=4><span id="isometrico"></span></font>
				</b></td>
		</tr>
		<tr>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 2px solid #000000; border-right: 1px solid #000000"
				colspan=2 height="50" align="center" valign=middle bgcolor="#D9D9D9"><b>
					<font face="Arial Narrow" size=4>PLANTA:</font>
				</b></td>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
				colspan=2 align="center" valign=middle>
				<font face="Arial Narrow" size=4><span id="planta"></span></font>
			</td>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
				colspan=2 align="center" valign=middle bgcolor="#D9D9D9"><b>
					<font face="Arial Narrow" size=4>ORDEN DE SERVICIO</font>
				</b></td>
			<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
				align="center" valign=middle sdval="25" sdnum="1033;">
				<font face="Arial Narrow" size=4><span id="ods"></span></font>
			</td>
		</tr>
		<tr>
			<td style="border-top: 1px solid #000000; border-left: 2px solid #000000; border-right: 2px solid #000000"
				colspan=11 height="13" align="center" valign=middle bgcolor="#FFFFFF"><b>
					<font face="Arial Narrow" size=4><br></font>
				</b></td>
		</tr>

		<tbody id="datosTabla">


		</tbody>

		 

			<tr>
				<td style="border-top: 2px solid #000000; border-bottom: 1px solid #000000; border-left: 2px solid #000000; border-right: 2px solid #000000"
					colspan=11 height="40" align="left" valign=middle bgcolor="#A6A6A6"><b>
						<font face="Arial Narrow" size=4>OBSERVACIONES:</font>
						<button type="button" class="btn btn-info btn-sm oculto-impresion" id="btnagregarObs"
				onclick="agregarObs()">Agregar Observación</button>
				<button type="button" class="btn btn-info btn-sm m-1 oculto-impresion" onclick="adjuntar()">Adjuntar
					archivo</button>
				<button type="button" class="btn btn-warning btn-sm m-1 oculto-impresion" onclick="verArchivos()">Ver
					archivos</button>
					</b></td>
			</tr>
			<tr>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 2px solid #000000; border-right: 2px solid #000000"
					colspan=11 align="left" valign=middle ><table id="tblobs" style="width: 100%;" class="oculto">
						<tr>
							<td colspan="4">
								<textarea id="obs100" style="width: 100%;" rows="3" class="activo"
									placeholder="Observaciones..."></textarea>
							</td>
						</tr>
						<tr>
	
							<td>
								<input type="text" id="nombre100" placeholder="Nombre" class="activo">
							</td>
	
							<td style="width: 200px;">
								<input type="text" id="registro100" placeholder="CC/REGISTRO" class="activo">
							</td>
							<td>
								<button type="button" class="btn btn-info btn-block" id="btnFirmar100"
									onclick="abrirFirma('100')">Firmar</button>
								<img src="" id="firma100" width="130px" height="50px" class="oculto">
							</td>
							<td>
	
							</td>
						</tr>
					</table></td>
			</tr>
	
			<tr>
				<td style="border-top: 1px solid #000000; border-bottom: 2px solid #000000; border-left: 2px solid #000000; border-right: 2px solid #000000"
					colspan=11 height="42" align="left" valign=middle bgcolor="#FFFFFF"  id="observaciones"><b>
						<font face="Arial Narrow"><br></font>
					</b></td>
			</tr>
			<tr>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 2px solid #000000"
					height="41" align="center" valign=middle>
					<font face="Arial Narrow"><br></font>
				</td>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000" align="center" valign=middle>
					<font face="Arial Narrow"><br></font>
				</td>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000" align="center" valign=middle>
					<font face="Arial Narrow"><br></font>
				</td>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000" align="center" valign=middle>
					<font face="Arial Narrow"><br></font>
				</td>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000" align="center" valign=middle>
					<font face="Arial Narrow"><br></font>
				</td>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000" align="center" valign=middle>
					<font face="Arial Narrow"><br></font>
				</td>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000" align="center" valign=middle>
					<font face="Arial Narrow"><br></font>
				</td>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000" align="center" valign=middle>
					<font face="Arial Narrow"><br></font>
				</td>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000" align="center" valign=middle>
					<font face="Arial Narrow"><br></font>
				</td>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000" align="center" valign=middle>
					<font face="Arial Narrow"><br></font>
				</td>
				<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-right: 2px solid #000000"
					align="center" valign=middle>
					<font face="Arial Narrow"><br></font>
				</td>
			</tr>
			<tr>
				<td style="border-left: 2px solid #000000; border-right: 2px solid #000000" colspan=11 height="22"
					align="center" valign=middle><i>
						<font face="Arial Narrow">Documento emitido por el Servicio de Calidad de la Compañía. El documento
							es propiedad de UT ITALCO. La empresa protegerá sus propios derechos en los tribunales civiles y
							penales de acuerdo con la ley.</font>
					</i></td>
			</tr>
			<tr>
				<td style="border-bottom: 2px solid #000000; border-left: 2px solid #000000; border-right: 2px solid #000000"
					colspan=11 height="25" align="center" valign=middle>
					<font face="Arial Narrow">** Fin del formato **</font>
				</td>
			</tr>
		
		 


	
	</table>
	<!-- Modal -->
	<div class="modal" id="modalFirma" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content" style="width: 600px;">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Firmar Documento</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<center><canvas id="canvas" style="border: 1px solid black;" width="560" height="320"></canvas>
						<br><input type="checkbox" id="poldatos" checked>
						Acepto las <a href="javascript::void(0)" onclick="mostraraviso()">políticas de protección de
							datos personales</a>
					</center>

				</div>
				<div class="modal-footer">

					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="button" class="btn btn-danger" id="btnLimpiar">Limpiar</button>
					<button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="pasarFirma()">Pasar a
						documento</button>

				</div>
			</div>
		</div>
	</div>
	<!-- ************************************************************************** -->
	<!-- ************************************************************************** -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
		integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous">
	</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
		integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous">
	</script>

	<script>
		// var anchoTblCuerpo = $('#tblcuerpo').width();
		// $('#tblpie').width(anchoTblCuerpo)
		// $('#tblobs').width(anchoTblCuerpo)


		function agregarObs() {
			$('#tblobs').removeClass("oculto")
			$('#btnagregarObs').addClass("oculto")
		}

		var imagencargada = null
		var idImagen = null

		var clase = null

		var user = sessionStorage.getItem('usercal')
		var tipouser = sessionStorage.getItem('tipouser')

		if (tipouser == 'ecopetrol') {
			$("input, select,  textarea").prop('disabled', true);
			$('.ecp').prop('disabled', false)
			$('.ut').prop('disabled', true)
			//$("#info input").prop("disabled", true);
		}

		if (tipouser == 'italco') {
			// $("input, select,  textarea").prop('disabled', false);
			$('.ecp').prop('disabled', true)
			// $('.ut').prop('disabled', true)
			//$("#info input").prop("disabled", true);
		}

		$('.activo').prop('disabled', false)

		var items = []
		var listaArchivos = []
		var arrayInfo = []



		// Set up the canvas
		var canvas = document.querySelector("#canvas");
		var ctx = canvas.getContext("2d");
		ctx.strokeStyle = "#222222";
		ctx.lineWidth = 2;


		$btnDescargar = document.querySelector("#btnDescargar")
		$btnLimpiar = document.querySelector("#btnLimpiar")
		$btnGenerarDocumento = document.querySelector("#btnGenerarDocumento");



		// Get a regular interval for drawing to the screen
		window.requestAnimFrame = (function (callback) {
			return window.requestAnimationFrame ||
				window.webkitRequestAnimationFrame ||
				window.mozRequestAnimationFrame ||
				window.oRequestAnimationFrame ||
				window.msRequestAnimaitonFrame ||
				function (callback) {
					window.setTimeout(callback, 1000 / 60);
				};
		})();


		const limpiarCanvas = () => {
			// Colocar color blanco en fondo de canvas
			clearCanvas();
		};
		limpiarCanvas();
		$btnLimpiar.onclick = limpiarCanvas;
		// Escuchar clic del botón para descargar el canvas



		window.obtenerImagen = () => {
			return $canvas.toDataURL();
		};


		// Set up mouse events for drawing
		var drawing = false;
		var mousePos = {
			x: 0,
			y: 0
		};
		var lastPos = mousePos;
		canvas.addEventListener("mousedown", function (e) {
			drawing = true;
			lastPos = getMousePos(canvas, e);
		}, false);
		canvas.addEventListener("mouseup", function (e) {
			drawing = false;
		}, false);
		canvas.addEventListener("mousemove", function (e) {
			mousePos = getMousePos(canvas, e);
		}, false);

		// Set up touch events for mobile, etc
		canvas.addEventListener("touchstart", function (e) {
			mousePos = getTouchPos(canvas, e);
			var touch = e.touches[0];
			var mouseEvent = new MouseEvent("mousedown", {
				clientX: touch.clientX,
				clientY: touch.clientY
			});
			canvas.dispatchEvent(mouseEvent);
		}, false);
		canvas.addEventListener("touchend", function (e) {
			var mouseEvent = new MouseEvent("mouseup", {});
			canvas.dispatchEvent(mouseEvent);
		}, false);
		canvas.addEventListener("touchmove", function (e) {
			var touch = e.touches[0];
			var mouseEvent = new MouseEvent("mousemove", {
				clientX: touch.clientX,
				clientY: touch.clientY
			});
			canvas.dispatchEvent(mouseEvent);
		}, false);


		// Prevent scrolling when touching the canvas
		document.body.addEventListener("touchstart", function (e) {
			if (e.target == canvas) {
				e.preventDefault();
			}
		}, {
			passive: false
		});
		document.body.addEventListener("touchend", function (e) {
			if (e.target == canvas) {
				e.preventDefault();
			}
		}, false);
		document.body.addEventListener("touchmove", function (e) {
			if (e.target == canvas) {
				e.preventDefault();
			}
		}, false);

		// Get the position of the mouse relative to the canvas
		function getMousePos(canvasDom, mouseEvent) {
			var rect = canvasDom.getBoundingClientRect();
			return {
				x: mouseEvent.clientX - rect.left,
				y: mouseEvent.clientY - rect.top
			};
		}

		// Get the position of a touch relative to the canvas
		function getTouchPos(canvasDom, touchEvent) {
			var rect = canvasDom.getBoundingClientRect();
			return {
				x: touchEvent.touches[0].clientX - rect.left,
				y: touchEvent.touches[0].clientY - rect.top
			};
		}

		// Draw to the canvas
		function renderCanvas() {
			if (drawing) {
				ctx.moveTo(lastPos.x, lastPos.y);
				ctx.lineTo(mousePos.x, mousePos.y);
				ctx.stroke();
				lastPos = mousePos;
			}
		}

		// Clear the canvas
		function clearCanvas() {
			canvas.width = canvas.width;
		}

		// Allow for animation
		(function drawLoop() {
			requestAnimFrame(drawLoop);
			renderCanvas();
		})();


		function abrirFirma(id, c) {

				clase = c
				idImagen = id;

				if(id == 100){
					limpiarCanvas()
						var myModal = new bootstrap.Modal(document.getElementById('modalFirma'))
						myModal.show()
				}

				if(clase == 'sup'){
					if($('#fechasup'+id).val()!= "" && $('#nombresup'+id).val()!= ""  &&  $('#horasup'+id).val()!= "" && $('#registrosup'+id).val()!= "" ){
						limpiarCanvas()
						var myModal = new bootstrap.Modal(document.getElementById('modalFirma'))
						myModal.show()
					}else{
						Swal.fire({
							position: 'top-end',
							icon: 'info',
							title: 'Por favor registre primero fecha, hora, nombre y  # de registro...',
							showConfirmButton: false,
							timer: 2500
						})
					}
				}

				if(clase == 'q'){
					if($('#fechaq'+id).val()!= "" && $('#nombreq'+id).val()!= ""  &&  $('#horaq'+id).val()!= "" && $('#registroq'+id).val()!= "" ){
						limpiarCanvas()
						var myModal = new bootstrap.Modal(document.getElementById('modalFirma'))
						myModal.show()
					}else{
						Swal.fire({
							position: 'top-end',
							icon: 'info',
							title: 'Por favor registre primero fecha, hora, nombre y  # de registro...',
							showConfirmButton: false,
							timer: 2500
						})
					}
				}
				
				if(clase == 'ecp'){
					if($('#fechaecp'+id).val()!= "" && $('#nombreecp'+id).val()!= ""  &&  $('#horaecp'+id).val()!= "" && $('#registroecp'+id).val()!= "" ){
						limpiarCanvas()
						var myModal = new bootstrap.Modal(document.getElementById('modalFirma'))
						myModal.show()
					}else{
						Swal.fire({
							position: 'top-end',
							icon: 'info',
							title: 'Por favor registre primero fecha, hora, nombre y  # de registro...',
							showConfirmButton: false,
							timer: 2500
						})
					}
				}


		}



		function pasarFirma() {

			if ($('#poldatos').prop('checked')) {

				imagencargada = canvas.toDataURL("image/png");
				
				if(clase == 'sup'){
					document.querySelector("#firmasup" + idImagen).src = canvas.toDataURL("image/png");
					$('#firmasup' + idImagen).removeClass('oculto')
					$('#btnFirmarsup' + idImagen).hide()
					actFirmaSup()
				}

				if(clase == 'q'){
					document.querySelector("#firmaq" + idImagen).src = canvas.toDataURL("image/png");
					$('#firmaq' + idImagen).removeClass('oculto')
					$('#btnFirmarq' + idImagen).hide()
					actFirmaSup()
				}

				if(clase == 'ecp'){
					document.querySelector("#firmaecp" + idImagen).src = canvas.toDataURL("image/png");
					$('#firmaecp' + idImagen).removeClass('oculto')
					$('#btnFirmarecp' + idImagen).hide()
					actFirmaSup()
				}
				

				

			} else {
				Swal.fire({
					position: 'top-end',
					icon: 'info',
					title: 'Debe aceptar las políticas de protección de datos perasonales',
					showConfirmButton: false,
					timer: 1500
				})
			}

			if (idImagen == 100) {
				document.querySelector("#firma100" ).src = canvas.toDataURL("image/png");
					guardarObs()
				}


			//document.querySelector("#btnfirmar").style.display = 'none';

		}

		function getParameterByName(name) {
			name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
			var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
				results = regex.exec(location.search);
			return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
		}

		var tag = getParameterByName('tag');
		var  lazo = getParameterByName('ing');


		var arrayDatos = []
		var arrayObs = []
		var arrayDoc = []
		var firmasItems = []
		var cmls = []

		odsq = localStorage.getItem('odsq');
		equipos = sessionStorage.getItem('equipo')
		alcance = sessionStorage.getItem('servicio')
		esp = sessionStorage.getItem('esp')

		var server = 'https://utitalco.com/calidad/server/';
		cargando()


		$.post(server + 'cargarMiscInst.php', {
				ods: odsq,
				tag: tag,
				lazo: lazo
			},
			function (resp) {
				arrayInfo =  resp
				arrayDatos = resp.datos
				arrayObs = resp.observaciones
				arrayDoc = resp.doc
				
				cargarDatos()


			})

		function actFirmaSup(){

			var fechasup = $('#fechasup'+idImagen).val()
			var horasup = $('#horasup'+idImagen).val()
			var nombresup = $('#nombresup'+idImagen).val()
			var registrosup = $('#registrosup'+idImagen).val()
			var img = document.getElementById("firmasup"+idImagen);
			if(fechasup != ''){
				var firmasup = img.src
			}else{
				var firmasup = ''
			}

			// console.log(fechasup)
			// console.log(horasup)
			// console.log(nombresup)
			// console.log(registrosup)
			// console.log(firmasup)

			var fechaq = $('#fechaq'+idImagen).val()
			var horaq = $('#horaq'+idImagen).val()
			var nombreq = $('#nombreq'+idImagen).val()
			var registroq = $('#registroq'+idImagen).val()
			var img = document.getElementById("firmaq"+idImagen);
			 
			if(fechaq != ''){
				var firmaq = img.src
			}else{
				var firmaq = ''
			}

			// console.log(fechaq)
			// console.log(horaq)
			// console.log(nombreq)
			// console.log(registroq)
			// console.log(firmaq)

			var fechaecp = $('#fechaecp'+idImagen).val()
			var horaecp = $('#horaecp'+idImagen).val()
			var nombreecp = $('#nombreecp'+idImagen).val()
			var registroecp = $('#registroecp'+idImagen).val()
			var img = document.getElementById("firmaecp"+idImagen);
			 
			if(fechaecp != ''){
				var firmaecp = img.src
			}else{
				var firmaecp = ''
			}

			// console.log(fechaecp)
			// console.log(horaecp)
			// console.log(nombreecp)
			// console.log(registroecp)
			// console.log(firmaecp)

			var arrayFirmas = []

			arrayFirmas.push({
				"fechasup": fechasup,
				"horasup": horasup,
				"nombresup": nombresup,
				"firmasup": firmasup,
				"registrosup": registrosup,
				"fechaq": fechaq,
				"horaq": horaq,
				"nombreq": nombreq,
				"firmaq": firmaq,
				"registroq": registroq,
				"fechaecp": fechaecp,
				"horaecp": horaecp,
				"nombreecp": nombreecp,
				"firmaecp": firmaecp,
				"registroecp": registroecp

			})

			console.log(arrayFirmas)

			$.post(server + 'actFirmasMiscInst.php', {
                    ods: odsq,
                    tag: tag,
					lazo:lazo,
					id:idImagen,
                    datos: JSON.stringify(arrayFirmas)
                },
                function (res) {
                    console.log(res)
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        width: 100,
                        showConfirmButton: false,
                        timer: 1500
                    })
                })

		}



		function actItem(id, e){
			// alert(id)
			// alert(e.value)
			// alert(e.id)

			$.post(server + 'actItemsMiscInst.php', {
                    ods: odsq,
                    tag: tag,
					lazo:lazo,
					id:id,
					item:e.id,
					valor:e.value
                },
                function (res) {
                    console.log(res)
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        width: 100,
                        showConfirmButton: false,
                        timer: 1500
                    })
                })

		}

		function cargarDatos() {

			$('#unidad').html(arrayDatos[0].unidad)
			$('#planta').html(arrayDatos[0].planta)
			$('#ods').html(arrayDatos[0].ods)
			$('#isometrico').html(arrayDatos[0].isometrico)
			$('#lazo').html(arrayDatos[0].lazo)

			var html = ''

			for(var i=0; i<arrayDatos.length; i++){

			var firmas = JSON.parse(arrayDatos[i].firmas);

			console.log(firmas)
			 

			html += `
							<tr>
								<td style="border-top: 2px solid #000000; border-bottom: 1px solid #000000; border-left: 2px solid #000000; border-right: 2px solid #000000"
									colspan=11 height="48" align="left" valign=middle bgcolor="#A6A6A6"><b>
										<font face="Arial Narrow" size=4>${i+1}. ACTIVIDADES DESARROLLADAS EN EL MISCELANEO </font>
									</b></td>
							</tr>
							
							<tr>
								<td style="border-left: 2px solid #000000" height="45" align="center" valign=middle bgcolor="#FFFFFF">

									<select id="item1" style="width: 70px;" class="" onchange="actItem(${arrayDatos[i].id}, this)">
										<option value="${arrayDatos[i].item1}">${arrayDatos[i].item1}</option>
										<option value="OK">OK</option>
										<option value="NA">NA</option>
									</select>

									
								</td>
								<td align="left" valign=middle bgcolor="#FFFFFF" colspan="3">
									<font face="Arial Narrow" size=4>Verificación de trabajos ejecutados </font>
								</td>

								<td align="left" valign=middle bgcolor="#FFFFFF"><b>
										<font face="Arial Narrow" size=4><br></font>
									</b></td>
								<td align="left" valign=middle bgcolor="#FFFFFF"><b>
										<font face="Arial Narrow" size=4>
											<select id="item2" style="width: 70px;" class=""  onchange="actItem(${arrayDatos[i].id}, this)">
												<option value="${arrayDatos[i].item2}">${arrayDatos[i].item2}</option>
												<option value="OK">OK</option>
												<option value="NA">NA</option>
											</select>
								</td>
								<td align="left" valign=middle bgcolor="#FFFFFF" colspan="4">
									<font face="Arial Narrow" size=4>Verificación de controles de calidad requeridos </font>
								</td>

								<td style="border-right: 2px solid #000000" align="left" valign=middle bgcolor="#FFFFFF"><b>
										<font face="Arial Narrow" size=3><br></font>
									</b></td>
							</tr>
							<tr>
								<td style="border-left: 2px solid #000000" height="42" align="center" valign=middle bgcolor="#FFFFFF">
									<select id="item3" style="width: 70px;" class=""  onchange="actItem(${arrayDatos[i].id}, this)">
										<option value="${arrayDatos[i].item3}">${arrayDatos[i].item3}</option>
										<option value="OK">OK</option>
										<option value="NA">NA</option>
									</select>
								</td>
								<td align="left" valign=middle bgcolor="#FFFFFF" colspan="3">
									<font face="Arial Narrow" size=4>Inspección Visual</font>
								</td>

								<td align="left" valign=middle bgcolor="#FFFFFF"><b>
										<font face="Arial Narrow" size=4><br></font>
									</b></td>
								<td align="left" valign=middle bgcolor="#FFFFFF"><b>
										<font face="Arial Narrow" size=4><br></font>
									</b></td>
								<td align="left" valign=middle bgcolor="#FFFFFF"><b>
										<font face="Arial Narrow" size=4><br></font>
									</b></td>
								<td align="left" valign=middle bgcolor="#FFFFFF"><b>
										<font face="Arial Narrow" size=4><br></font>
									</b></td>
								<td align="left" valign=middle bgcolor="#FFFFFF"><b>
										<font face="Arial Narrow" size=4><br></font>
									</b></td>
								<td align="left" valign=middle bgcolor="#FFFFFF"><b>
										<font face="Arial Narrow" size=3><br></font>
									</b></td>
								<td style="border-right: 2px solid #000000" align="left" valign=middle bgcolor="#FFFFFF"><b>
										<font face="Arial Narrow" size=3><br></font>
									</b></td>
							</tr>

							<tr>
								<td style="border-left: 2px solid #000000; border-right: 2px solid #000000;" colspan=11 height="52"
									align="left" valign=middle bgcolor="#999999"><b>
										<font face="Arial Narrow" size=4>DESCRIPCIÓN DE LA ACTIVIDAD</font>
									</b></td>
							</tr>
							<tr>
								<td style="border-left: 2px solid #000000; border-right: 2px solid #000000" colspan=11 height="117"
									align="justify" valign=middle bgcolor="#FFFFFF">
									<font face="Arial Narrow" size=4>
										${arrayDatos[i].actividad}	
									</font>
								</td>
							</tr>
							<tr>
								<td style="border-top: 2px solid #000000; border-bottom: 1px solid #000000; border-left: 2px solid #000000; border-right: 1px solid #000000"
									colspan=3 height="49" align="center" valign=middle bgcolor="#D9D9D9"><b>
										<font face="Arial Narrow" size=4>RESPONSABLES</font>
									</b></td>
								<td style="border-top: 2px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									align="center" valign=middle bgcolor="#D9D9D9"><b>
										<font face="Arial Narrow" size=4>FECHA EJECUCIÓN</font>
									</b></td>
								<td style="border-top: 2px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									align="center" valign=middle bgcolor="#D9D9D9"><b>
										<font face="Arial Narrow" size=4>HORA</font>
									</b></td>
								<td style="border-top: 2px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									colspan=3 align="center" valign=middle bgcolor="#D9D9D9"><b>
										<font face="Arial Narrow" size=4>NOMBRES</font>
									</b></td>
								<td style="border-top: 2px solid #000000; border-bottom: 1px solid #000000; border-right: 1px solid #000000"
									colspan=2 align="center" valign=middle bgcolor="#D9D9D9"><b>
										<font face="Arial Narrow" size=4>FIRMA</font>
									</b></td>
								<td style="border-top: 2px solid #000000; border-bottom: 1px solid #000000; border-right: 2px solid #000000"
									align="center" valign=middle bgcolor="#D9D9D9"><b>
										<font face="Arial Narrow" size=4>REGISTRO</font>
									</b></td>
							</tr>
							<tr>
								<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 2px solid #000000; border-right: 1px solid #000000"
									colspan=3 height="50" align="center" valign=middle bgcolor="#FFFFFF">
									<font face="Arial Narrow" size=4>SUPERVISOR EJECUTOR</font>
								</td>
								<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									align="center" valign=middle bgcolor="#FFFFFF">
									<input type="date" id="fechasup${arrayDatos[i].id}" class="ut" value="${firmas[0].fechasup}">
									</td>
								<td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									align="left" valign=middle bgcolor="#FFFFFF">
									<input type="time" id="horasup${arrayDatos[i].id}" class="ut"  value="${firmas[0].horasup}"></td>
								<td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									colspan=3 align="left" valign=middle bgcolor="#FFFFFF">
									<input type="text" id="nombresup${arrayDatos[i].id}" class="ut"  value="${firmas[0].nombresup}"></td>

								<td colspan="2" style="border-bottom: 1px solid #000000; border-right: 1px solid #000000" align="center"
									valign=middle bgcolor="#FFFFFF">
									<center>`

										if(firmas[0].fechasup == ''){
												html += `
												<button type="button" class="btn btn-info btn-block ut oculto-impresion" id="btnFirmarsup${arrayDatos[i].id}"
													onclick="abrirFirma('${arrayDatos[i].id}', 'sup')">Firmar</button>
												<img src="" id="firmasup${arrayDatos[i].id}" width="130px" height="50px" class="oculto">
														`
										}else{
											html += `
												<img src="${firmas[0].firmasup}" id="firmasup${arrayDatos[i].id}" width="130px" height="50px" class="visible">
														`
										}

										html += `


									</center>
								</td>
								<td style="border-bottom: 1px solid #000000; border-right: 2px solid #000000" align="left" valign=middle
									bgcolor="#FFFFFF">
									<input type="text" id="registrosup${arrayDatos[i].id}"  class="ut"  value="${firmas[0].registrosup}">
								</td>
							</tr>
							<tr>
								<td style="border-bottom: 1px solid #000000; border-left: 2px solid #000000" colspan=3 height="50"
									align="center" valign=middle bgcolor="#FFFFFF">
									<font face="Arial Narrow" size=4>QAQC</font>
								</td>
								<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									align="center" valign=middle bgcolor="#FFFFFF">
									<input type="date" id="fechaq${arrayDatos[i].id}" class="ut"  value="${firmas[0].fechaq}"></td>
								<td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									align="left" valign=middle bgcolor="#FFFFFF">
									<input type="time" id="horaq${arrayDatos[i].id}" class="ut"  value="${firmas[0].horaq}"></td>
								<td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									colspan=3 align="left" valign=middle bgcolor="#FFFFFF">
									<input type="text" id="nombreq${arrayDatos[i].id}" class="ut"  value="${firmas[0].nombreq}"></td>

								<td colspan="2" style="border-bottom: 1px solid #000000; border-right: 1px solid #000000" align="center"
									valign=middle bgcolor="#FFFFFF">
									<center>`

										if(firmas[0].fechaq == ''){
												html += `
												<button type="button" class="btn btn-info btn-block ut oculto-impresion" id="btnFirmarq${arrayDatos[i].id}"
													onclick="abrirFirma('${arrayDatos[i].id}','q')">Firmar</button>
												<img src="" id="firmaq${arrayDatos[i].id}" width="130px" height="50px" class="oculto">
														`
										}else{
											html += `
												
												<img src="${firmas[0].firmaq}" id="firmaq${arrayDatos[i].id}" width="130px" height="50px" class="visible">
														`
										}

										html += `
									</center>
								</td>
								<td style="border-bottom: 1px solid #000000; border-right: 2px solid #000000" align="left" valign=middle
									bgcolor="#FFFFFF"><b>
										<input type="text" id="registroq${arrayDatos[i].id}"   class="ut"  value="${firmas[0].registroq}">
									</b></td>
							</tr>
							<tr>
								<td style="border-bottom: 1px solid #000000; border-left: 2px solid #000000" colspan=3 height="50"
									align="center" valign=middle bgcolor="#FFFFFF"><b>
										<font face="Arial Narrow" size=3>GESTOR TÉCNICO ECOPETROL (1)</font>
									</b></td>
								<td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									align="center" valign=middle bgcolor="#FFFFFF">
									<input type="date" id="fechaecp${arrayDatos[i].id}" class="ecp"   value="${firmas[0].fechaecp}"></td>
								<td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									align="left" valign=middle bgcolor="#FFFFFF">
									<input type="time" id="horaecp${arrayDatos[i].id}" class="ecp"  value="${firmas[0].horaecp}"></td>
								<td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000"
									colspan=3 align="left" valign=middle bgcolor="#FFFFFF">
									<input type="text" id="nombreecp${arrayDatos[i].id}" class="ecp"   value="${firmas[0].nombreecp}"></td>

								<td colspan="2" style="border-bottom: 1px solid #000000; border-right: 1px solid #000000" align="center"
									valign=middle bgcolor="#FFFFFF">
									<center>`

										if(firmas[0].fechaecp == ''){
												html += `
												<button type="button" class="btn btn-info btn-block ecp oculto-impresion" id="btnFirmarecp${arrayDatos[i].id}"
													onclick="abrirFirma('${arrayDatos[i].id}','ecp')">Firmar</button>
												<img src="" id="firmaecp${arrayDatos[i].id}" width="130px" height="50px" class="oculto">
														`
										}else{
											html += `
												
												<img src="${firmas[0].firmaecp}" id="firmaecp${arrayDatos[i].id}" width="130px" height="50px" class="visible">
														`
										}

										html += `
							</center>
								</td>
								<td style="border-bottom: 1px solid #000000; border-right: 2px solid #000000" align="left" valign=middle
									bgcolor="#FFFFFF"><b>
										<input type="text" id="registroecp${arrayDatos[i].id}" class="ecp"  value="${firmas[0].registroecp}">
									</b></td>
							</tr>
							<tr>
								<td style="border-top: 1px solid #000000; border-bottom: 2px solid #000000; border-left: 2px solid #000000; border-right: 2px solid #000000"
									colspan=11 height="37" align="left" valign=middle bgcolor="#FFFFFF">
									<font face="Arial Narrow" size=3>(1) La firma del gestor técnico no exime al ejecutor de la
										responsabilidad de garantizar que los trabajos fueron realizados con la calidad requerida y la
										responsabilidad contractual.</font>
								</td>
							</tr>
								`

								$('#datosTabla').html(html)

								veriUser()

			}

			//CARGAR OBSERVACIONES

			if (arrayObs != "") {
                var arrayObservaciones = arrayObs
                var html = ''
                for (var i = 0; i < arrayObservaciones.length; i++) {
                    html = `<b>Nota ${i+1}: </b>
                    ${arrayObservaciones[i].obs} | ${arrayObservaciones[i].nombre} | Registro: ${arrayObservaciones[i].registro} | Fecha: ${arrayObservaciones[i].fecha} | Firma: <span id="firm${i}" style="width: 60px;"></span> <br>--------------------------------------------------------------------------------------------------------------------------------------------------------------------<br>
                    `
                    $('#observaciones').append(html)
                    const imagef = document.createElement('img')
                    imagef.src = arrayObservaciones[i].firma
                    imagef.height = "60"
                    document.querySelector('#firm' + i).appendChild(imagef)

                }
            }


			//cargar archivos
			if(arrayDoc  != ""){
				listaArchivos = arrayDoc

			}

			Swal.close()


		}

		
		
		function mostraraviso() {
			let timerInterval
			Swal.fire({
				title: 'Políticas de protección de datos personales',
				text: 'En cumplimiento con la Ley 1581 de protección de datos personales, se le informa que los datos suministrados serán incorporados a una base de datos cuya finalidad es el registro de control de actividades RCA y las actuaciones que se deriven de dicha gestión, cuyo responsable del tratamiento es UT ITALCO. Mediante el registro de sus datos  a través de este formato usted autoriza a UT ITALCO, a tratar los datos con la finalidad descrita arriba.  Como Titular se le informa que podrá ejercer sus derechos de acceso y reclamos a través del correo de contacto pqrsbca@utitalco.com.',
				timer: 20000,
				timerProgressBar: true,
				didOpen: () => {
					Swal.showLoading()
					const b = Swal.getHtmlContainer().querySelector('b')
					timerInterval = setInterval(() => {
						b.textContent = Swal.getTimerLeft()
					}, 100)
				},
				willClose: () => {
					clearInterval(timerInterval)
				}
			}).then((result) => {
				/* Read more about handling dismissals below */
				if (result.dismiss === Swal.DismissReason.timer) {
					console.log('I was closed by the timer')
				}
			})
		}

		function cargando() {
			let timerInterval
			Swal.fire({
				title: 'Cargando formato...!',
				timer: 20000,
				timerProgressBar: true,
				didOpen: () => {
					Swal.showLoading()
					const b = Swal.getHtmlContainer().querySelector('b')
					timerInterval = setInterval(() => {
						// b.textContent = Swal.getTimerLeft()
					}, 100)
				},
				willClose: () => {
					clearInterval(timerInterval)
				}
			}).then((result) => {
				/* Read more about handling dismissals below */
				if (result.dismiss === Swal.DismissReason.timer) {
					console.log('I was closed by the timer')
				}
			})
		}

		function verArchivos() {
			var htmltexto = ''
			for (var i = 0; i < arrayDatos.length; i++) {
				listaArchivos = JSON.parse(arrayDatos[i].doc)

				for (var a = 0;a< listaArchivos.length; a++) {
					htmltexto += `
					<a href='https://utitalco.com/calidad/server/archivos/${listaArchivos[a].archivo}' target='_blank'>${listaArchivos[a].archivo}</a> <br>
				`
				}
			}

			Swal.fire({
				title: '<strong>Lista de adjuntos</strong>',
				icon: 'info',
				html: `
			Pulse click sobre el archivo que desea descargar... <br>
			${htmltexto}
			`

			})
		}

		function adjuntar() {
            Swal.fire({
                title: 'Adjuntar archivo',
                html: `
                <input type="file" id="archivo" class="form-control" placeholder="Buscar...">
                `,
                showCancelButton: true,
                confirmButtonText: 'Adjuntar'
            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {

                    var formData = new FormData();
                    var files = $('#archivo')[0].files[0];
                    formData.append('archivo', files);
                    formData.append('ods', odsq);
                    formData.append('tag', tag);
					formData.append('lazo', lazo);
                    $.ajax({
                        url: server + 'guardarArchivoMiscInst.php',
                        type: 'post',
                        data: formData,
                        contentType: false,
                        processData: false,
                        success: function (response) {
                            console.log(response)

                            if (response.msn == "Ok") {
                                Swal.fire({
                                    position: 'top-end',
                                    icon: 'success',
                                    title: 'Archivo cargado correctamente...',
                                    showConfirmButton: false,
                                    timer: 1500
                                }).then(() => {

                                    location.reload();
                                })
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: 'Formato de archivo incorrecto...!',
                                })
                            }
                        }
                    });

                }
            })
        }
    
		function guardarObs() {
            var observacion = $('#obs100').val()
            var nombreobs = $('#nombre100').val()
            var registroobs = $('#registro100').val()
            var img = document.getElementById("firma100");

            // crea un nuevo objeto `Date`
            var today = new Date();

            // obtener la fecha y la hora
            var now = today.toLocaleString();
            var firmaobs = img.src

			if(arrayObs != ""){

				var arrayLmp = arrayObs
			}else{
				var arrayLmp = []
			}

            arrayLmp.push({
                "obs": observacion,
                "nombre": nombreobs,
                "registro": registroobs,
                "firma": firmaobs,
                "fecha": now
            })

            $.post(server + 'actMiscInstObs.php', {
                    ods: odsq,
                    tag: tag,
					lazo:lazo,
                    datos: JSON.stringify(arrayLmp)
                },
                function (res) {
                    console.log(res)
                    location.reload()
                })

        }

		
		function veriUser(){
			if (tipouser == 'ecopetrol') {
				$("input, select,  textarea").prop('disabled', true);
				$('.ecp').prop('disabled', false)
				$('.ut').prop('disabled', true)
				//$("#info input").prop("disabled", true);
			}

			if (tipouser == 'italco') {
				// $("input, select,  textarea").prop('disabled', false);
				$('.ecp').prop('disabled', true)
				// $('.ut').prop('disabled', true)
				//$("#info input").prop("disabled", true);
			}

			$('.activo').prop('disabled', false)
		}



	</script>





</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UT ITALCO</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous" />

  <script src="weldbook/jquery.min.js"></script>
  <script src="weldbook/jquery-ui.min.js"></script>
  <script src="weldbook/jquery.jqGrid.min.js"></script>
  <script src="weldbook/grid.locale-en.js"></script>
  <link rel="stylesheet" href="weldbook/jquery-ui.css" />
  <link rel="stylesheet" href="weldbook/ui.jqgrid_4.min.css" />
  <!-- <link rel="stylesheet" href="ui.jqgrid.css"> -->

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@100;500;700&family=Roboto:wght@100;300;400;500&display=swap"
    rel="stylesheet" />

    <script type="text/javascript" src="https://code.highcharts.com/highcharts.js"></script>
    <!-- <script src="https://code.highcharts.com/highcharts-3d.js"></script>
    <script src="https://code.highcharts.com/modules/cylinder.js"></script>
    <script src="https://code.highcharts.com/modules/funnel3d.js"></script>
    <script src="https://code.highcharts.com/modules/pyramid3d.js"></script> -->
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
	<script src="https://code.highcharts.com/modules/export-data.js"></script>
	<script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.2.61/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.svg.js"></script>
  

    <style>
        .highcharts-color-0 {
            fill: #7cb5ec;
            
        }

        .highcharts-color-2 {
            fill: #9a9a9c;
             
        }

        .highcharts-color-1 {
            fill: #90ed7d;
            
        }

        .highcharts-color-3 {
            fill: #f7a35c;
            
        }

        .highcharts-color-4 {
            fill: #8085e9;
             
        }

        .highcharts-color-5 {
            fill: #f15c80;
            
        }

        /* Series options */

        #container {
            height: 400px;
        }

        .highcharts-figure,
        .highcharts-data-table table {
            min-width: 310px;
            max-width: 800px;
            margin: 1em auto;
        }

        .highcharts-data-table table {
            font-family: Verdana, sans-serif;
            border-collapse: collapse;
            border: 1px solid #ebebeb;
            margin: 10px auto;
            text-align: center;
            width: 100%;
            max-width: 500px;
        }

        .highcharts-data-table caption {
            padding: 1em 0;
            font-size: 1.2em;
            color: #555;
        }

        .highcharts-data-table th {
            font-weight: 600;
            padding: 0.5em;
        }

        .highcharts-data-table td,
        .highcharts-data-table th,
        .highcharts-data-table caption {
            padding: 0.5em;
        }

        .highcharts-data-table thead tr,
        .highcharts-data-table tr:nth-child(even) {
            background: #f8f8f8;
        }

        .highcharts-data-table tr:hover {
            background: #f1f7ff;
        }
    </style>

  <style>
    body {
      background-image: url("img/fondo.jpg");
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      height: 100hv;
      font-family: "Montserrat Alternates", sans-serif;
      font-family: "Roboto", sans-serif;
      font-weight: normal;
    }

    video {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      object-fit: cover;
      z-index: -9999;
    }

    .cab {
      margin-top: 30px;
      background-color: rgb(218, 255, 255);
      padding: 20px;
      border-radius: 15px;
    }

    .titulop {
      padding: 15px;
      padding-top: 20px;
      align-items: center;
      vertical-align: middle;
      text-align: center;
    }

    .mnubotones {
      position: relative;
    }

    .cajones {
      float: left;
      margin: 10px;
    }

    .mbt {
      height: 100px;
    }

    .card {
      box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
      width: 21rem;
    }

    .cuerpo {
      position: relative;
      margin-top: 20px;
      border-radius: 10px;
      background-color: rgb(243, 243, 243);
      padding: 15px;
    }

    .padre {
      display: flex;
      align-items: center;
    }

    .micontainer {
      margin: 0 auto;
      width: 97%;
    }

    table thead td {
      vertical-align: middle;
    }

    th.ui-th-column {
      border-width: 1px;
      border-style: solid;
      border-color: #b1b1b1;
    }

    @media only screen and (max-width: 600px) {
      .mnubotones {
        margin-top: 30px;
        display: block;
        justify-content: center;
        align-items: center;
      }

      .card {
        box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
        width: 100%;
      }
    }
  </style>

   
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="#"><img src="img/logo_m.png" width="100px" alt="" /></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <h5>CUADRO DE CONTROL BANCO PRINCIPAL ODS 033 ALISTAMIENTO CALDERA SB-2405</h5>
      </div>
    </div>
  </nav>
  <div class="micontainer">
    <div class="cuerpo">
      <div class="row">
        <div class="col-sm-12">
          Última actualización: <span id="fecha"> </span>
        </div>
      </div>
    </div>
  </div>

  <div class="micontainer">
    <div class="cuerpo">
      <div class="">
        <table class="table table-striped" id="grid1b"></table>
      </div>

      <div class="mt-3">
        <table class="table table-striped" id="grid1b2"></table>
      </div>
      <div class="row mt-3">
        <div class="col-sm-12">
          <div id="fig1"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous">
  </script>
  <script type="text/javascript" language="javascript" src="//cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js">
  </script>

  <script>
    var odsq = null;
    var datos = [];
    var url = "https://utitalco.com/calidad/033/alistamiento/weldbook/server/";
    var fechab = null

    var arrayAct = []
    var arrayPlan = []
    var arrayEje = []
    var arrayPdte = []
    var arrayAcumEje = []


    var user = sessionStorage.getItem("usercal");
    var tipouser = sessionStorage.getItem("tipouser");

    var ventana_ancho = $(window).width();
    var ventana_alto = $(window).height();

    if (ventana_ancho < 1300) {
      ventana_ancho = ventana_ancho - 70;
    } else {
      ventana_ancho = ventana_ancho - 100;
    }
    ventana_alto = ventana_alto - 220;

    solFecha()

    function solFecha(){
        Swal.fire({
            title: "Elegir Fecha",
            html: `
            <input type="date" id="fechab" class="form-control">
            `,
            showCancelButton: true,
            confirmButtonText: "Aceptar",
            cancelButtonText: "Cancelar"
            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                    fechab = $('#fechab').val(),
                    cargarDatos();
                } 
            });
        }

    function cargando() {
      let timerInterval;
      Swal.fire({
        title: "Cargando formato...!",
        timer: 120000,
        timerProgressBar: true,
        didOpen: () => {
          Swal.showLoading();
          const b = Swal.getHtmlContainer().querySelector("b");
          timerInterval = setInterval(() => {
            // b.textContent = Swal.getTimerLeft()
          }, 100);
        },
        willClose: () => {
          clearInterval(timerInterval);
        },
      }).then((result) => {
        /* Read more about handling dismissals below */
        if (result.dismiss === Swal.DismissReason.timer) {
          console.log("I was closed by the timer");
        }
      });
    }

    function cargandoPag() {
      let timerInterval;
      Swal.fire({
        title: "Procesando datos...!",
        timer: 120000,
        timerProgressBar: true,
        didOpen: () => {
          Swal.showLoading();
          const b = Swal.getHtmlContainer().querySelector("b");
          timerInterval = setInterval(() => {
            // b.textContent = Swal.getTimerLeft()
          }, 100);
        },
        willClose: () => {
          clearInterval(timerInterval);
        },
      }).then((result) => {
        /* Read more about handling dismissals below */
        if (result.dismiss === Swal.DismissReason.timer) {
          console.log("I was closed by the timer");
        }
      });
    }

    function cargar() {
      cargando();

      var formData = new FormData();
      var files = $("#excel")[0].files[0];
      formData.append("excel", files);
      formData.append("user", user);

      $.ajax({
        url: url + "guardarExcelCCPuntos.php",
        type: "post",
        data: formData,
        contentType: false,
        processData: false,
        success: function (response) {
          console.log(response);

          if (response.msn == "Realizado...") {
            Swal.fire({
              icon: "success",
              title: "Cargado...",
              text: "Excel cargado correctamente...!",
              showConfirmButton: false,
              timer: 3000,
            }).then(() => {
              location.reload();
            });
          } else {
            Swal.fire({
              icon: "error",
              title: "Oops...",
              text: "Formato de archivo incorrecto...!",
            });
          }
        },
      });
    }

    function cargarDatos() {
      cargandoPag();

      $.post(url + "cargarDatosCCBancoInf.php", {fecha:fechab}, function (resp) {
        datos = resp.banco;
        arrayDatos = resp.banco

        console.log(datos);

        $("#grid1b").jqGrid({
          datatype: "local",
          regional: "es", // this is default
          data: datos,
          colModel: [
                        {name: "item", label: "ITEM", width: 50,}, 
                        {name: "actividad", label: "ACTIVIDAD", width: 350,},
                        {name: "totplan", label: "TOTAL PLAN", width: 90, align:"center"},
                       
                        {name: "toteje", label: "TOTAL EJE", width: 90, align:"center"},
                        {name: "acumeje", label: "ACUMULADO EJE", width: 90, align:"center"},
                        {name: "avance", label: "% AVANCE", width: 90, align:"center"},
                        {name: "fecha", label: "FECHA", width: 80, align:"center"},
                        {name: "pendiente", label: "PENDIENTE", width: 80, align:"center"},
                        {name: "observaciones", label: "OBSERVACIONES", width: 320}                 
                    ],
          loadonce: true,
          shrinkToFit: false, // must be set with frozen columns, otherwise columns will be shrank to fit the grid width
          width: ventana_ancho,
          height: 300,
          rowNum: 1000,
          pager: "#jqGridPager",
        });

        $("#grid1b").jqGrid("filterToolbar", {
          autoSearch: true,
          searchOnEnter: false,
        });

        cargarBitacora();
      });
    }

    function cargarBitacora() {
      $.post(url + "cargarBitacoraCCBanco.php", function (resp) {
        datos = resp;

        Swal.close();

        $("#fecha").html(datos.fecha);

        cargarGraficas();
      });
    }

    function cargarGraficas() {
     

      for (var i = 0; i < arrayDatos.length; i++) {
        
        arrayAct.push(arrayDatos[i].actividad)
        arrayPlan.push(parseInt(arrayDatos[i].totplan))
        arrayEje.push(parseInt(arrayDatos[i].toteje))
        arrayAcumEje.push(parseInt(arrayDatos[i].acumeje))
        arrayPdte.push(parseInt(arrayDatos[i].pendiente))

    
      }

      Highcharts.chart("fig1", {
        credits: {
          enabled: false,
        },
        colors: [
                    "#00c901",
                    "#01005e",
                    "#efd520",
                    "#bfbfbf",
                    "#537b35",
                    "#a4c639",
                    "#537b35",
                    "#a4c639",
                    "#537b35",
                ],
        chart: {
          type: "column",
          
          // options3d: {
          //     enabled: true,
          //     alpha: 15,
          //     beta: 15,
          //     viewDistance: 25,
          //     depth: 40
          // }
        },
        title: {
          text: "<b>AVANCE ACTIVIDADES DE SEGUIMIENTO Y CONTROL</b>",
        },

        xAxis: {
          categories: arrayAct,
          crosshair: true,
        },

        yAxis: {
          min: 0,
          title: {
            text: "Cant",
          },
        },
        tooltip: {
          headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
          pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
            '<td style="padding:0"><b>{point.y:f}</b></td></tr>',
          footerFormat: "</table>",
          shared: true,
          useHTML: true,
        },
        plotOptions: {
          column: {
            pointPadding: 0.2,
            borderWidth: 0,
            dataLabels: {
              enabled: true,
            },
          },
        },
        series: [{
            name: "PLANEADO",
            data: arrayPlan,
          },
          {
            name: "EJECUTADAS DIA",
            data: arrayEje,
          },
          {
            name: "ACUMULADO EJE",
            data: arrayAcumEje,
          },
          {
            name: "PENDIENTES",
            data: arrayPdte,
          },
        ],
      });

     
    }
  </script>
</body>

</html>